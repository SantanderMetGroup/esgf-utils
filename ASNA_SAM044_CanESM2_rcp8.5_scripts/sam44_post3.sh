#!/bin/bash
##SBATCH --job-name=SAMpost3
##SBATCH --output=SAMpost3%j.out
##SBATCH --error=SAMpost3%j.out
##SBATCH --ntasks=1
##SBATCH --ntasks-per-node=16
##SBATCH --time=72:00:00
##SBATCH --mail-user=milovacj@unican.es
##SBATCH --reservation=meteo_16

# NOTE! This version of the script works for nco version 4.4.4 and cdo version 1.6.3
# For the newer versions of tools, outcome of the script might differ
# To use cdo version 1.9.8 and nco version 4.9.1 on Atlatmira:
# export PATH="/home/uc15/uc15004/miniconda3/bin:$PATH"
# source activate cdo #using this,cdo version 1.9.8 and nco version 4.9.1 are loaded

echo "I'm running in ${HOSTNAME}, and today is $(date)"

module load netcdf_tools # loading nco version 4.4.4 and cdo version 1.6.3
source ./dirs

expdir=${BASEDIR}
outdir=${OUTPUTPOST2}

export SWPP_TEMPORARY_STORAGE=$TMPDIR
export SWPP_WRFNCXNJ_TABLE="${SCRIPTDIR}/wrfncxnj.table"
export SWPP_NETCDF_ATTRIBUTES="${SCRIPTDIR}/attributes.cdl"
export SWPP_WRFNCXNJ_GATTR="${SCRIPTDIR}/wrfnc_extract_and_join.gattr_CORWES"
export SWPP_RLAT="${SCRIPTDIR}/rlat_file.nc"
export SWPP_RLON="${SCRIPTDIR}/rlon_file.nc"

bname="SAM-44_CCCma-CanESM2_rcp85_r1i1p1_UCAN-WRF341I_v2"
freq="day"

cd ${SCRIPTDIR}

function modify_them() {
  while read bname expdir; do
    test ${bname:0:1} = "#" && continue
   ./swpp_shifttime -i ${outdir}/mrros_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SFROFF -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mrso_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v MRSO -c 'soil_layers: sum'
   ./swpp_shifttime -i ${outdir}/mrro_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v MRRO -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/sfcWindmax_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v SPDUV10MAX -c 'time: maximum'
   ./swpp_shifttime -i ${outdir}/tasmaxts_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v T2MAXTS -c 'time: maximum'
   ./swpp_shifttime -i ${outdir}/tasmints_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v T2MINTS -c 'time: minimum'
   ./swpp_shifttime -i ${outdir}/tasmax_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v T2MAX -c 'time: maximum'
   ./swpp_shifttime -i ${outdir}/tasmin_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v T2MIN -c 'time: minimum'
   ./swpp_shifttime -i ${outdir}/sic_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v XICEM -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/snw_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v ACSNOW -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/sst_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SST -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mross_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v UDROFF -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/aclwdnt_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v ACLWDNT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/alb_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v ALBEDO -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/huss_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v Q2 -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/sfcWind_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v SPDUV10 -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ps_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v PSFC -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/psl_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v MSLP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rsus_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v ACSWUPB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rsut_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v ACSWUPT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rlus_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v ACLWUPB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/pr_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v RAINF -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rlut_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v ACLWUPT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clt_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rsds_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SWDOWN -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rlds_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v GLW -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hfss_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v HFX -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hfls_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v LH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/prw_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VIM -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clivi_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VIQI -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hurs_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RH2 -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/prls_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RAINNC -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hufs_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QFX -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/evspsbl_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SFCEVP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/evspsblpot_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v POTEVP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/prc_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RAINC -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/rsdt_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v ACSWDNT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clwvi_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VIQC -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/cll_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLL -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clm_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLM -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clh_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clice500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QICE -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clice200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QICE -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clfr850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLDFRA -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clfr500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLDFRA -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clfr200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v CLDFRA -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clwmr850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QCLOUD -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clwmr500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QCLOUD -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/clwmr200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QCLOUD -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/slw005_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v SH2O -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/slw025_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SH2O -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/slw15_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v SH2O -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/slw07_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SH2O -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mrsos025_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SMOIS -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mrsos005_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SMOIS -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mrsos15_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SMOIS -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/mrsos07_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SMOIS -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hus850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QVAPOR -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hus500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QVAPOR -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hus200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v QVAPOR -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hur850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hur500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/hur200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v RH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/snownc_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SNOWNC -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/snm_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v ACSNOM -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/snd_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SNOWH -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tas_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v T2 -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tsmax_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v TSK -c 'time: maximum'
   ./swpp_shifttime -i ${outdir}/tsmin_${bname}_${freq}_'????????-????????'.nc -l 0.5 -r 0.5 -v TSK -c 'time: minimum'
   ./swpp_shifttime -i ${outdir}/ta850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TEMP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ta500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TEMP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ta200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TEMP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tsos005_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TSLB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tsos025_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TSLB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tsos15_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TSLB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/tsos07_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v TSLB -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ts_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v SKINTEMP -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/uas_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v U10ER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ustar_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v UST -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ua850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v UER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ua500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v UER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/ua200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v UER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/vas_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v V10ER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/va850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/va500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/va200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v VER -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/zg850_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v GHT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/zg500_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v GHT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/zg200_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v GHT -c 'time: mean'
   ./swpp_shifttime -i ${outdir}/zmla_${bname}_${freq}_'????????-????????'.nc  -l 0.5 -r 0.5 -v PBLH -c 'time: mean'
  done
}

cat << EOF | modify_them
${bname} ${BASEDIR}
EOF



